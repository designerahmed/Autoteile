<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catalogue</title>

  <!-- jQuery + Turn.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turn.js@4/turn.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }

    /* flipbook */
    #flipbook {
      width: 40.6vw;
      height: 50vh;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      background: white;
      margin-bottom: 15px;
    }
    .page {
      width: 20.3vw;
      height: 50vh;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      background-color: #fff;
    }

    /* thumbnails */
    .thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }
    .thumbs img {
      width: 100px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .thumbs img:hover {
      transform: scale(1.05);
      border-color: #999;
    }

    /* responsive mobile */
    @media (max-width: 768px) {
      #flipbook {
        width: 95vw !important;
        height: 70vh !important;
      }
      .page {
        width: 95vw !important;
        height: 70vh !important;
      }
      .thumbs img { width: 70px; }
    }
  </style>
</head>
<body>

  <!-- الكتالوج -->
  <div id="flipbook"></div>

  <!-- المصغرات -->
  <div class="thumbs" id="thumbsPanel"></div>

  <script>
    const PAGE_COUNT = 18; // عدد الصفحات
    const pageFiles = [];
    for (let i = 1; i <= PAGE_COUNT; i++) {
      const n = String(i).padStart(2, '0');
      pageFiles.push(`pdf_pages/Fiche technique-${n}.jpg`);
    }

    const $flipbook = $("#flipbook");

    // أضف الصفحات كـ div مع data-src (lazy load)
    pageFiles.forEach((src, idx) => {
      $flipbook.append(`<div class="page" data-src="${src}" data-page="${idx + 1}"></div>`);
    });

    // المصغرات
    const $thumbs = $("#thumbsPanel");
    pageFiles.forEach((src, idx) => {
      const img = document.createElement("img");
      img.src = src;
      img.alt = `Page ${idx + 1}`;
      img.addEventListener("click", () => {
        $flipbook.turn("page", idx + 1);
      });
      $thumbs.append(img);
    });

    // lazy-load للصفحات
    function lazyLoad() {
      const pages = document.querySelectorAll(".page");
      if ("IntersectionObserver" in window) {
        const io = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const el = entry.target;
              const src = el.getAttribute("data-src");
              if (src) {
                const img = new Image();
                img.onload = () => {
                  el.style.backgroundImage = `url("${src}")`;
                  el.removeAttribute("data-src");
                };
                img.src = src;
              }
              observer.unobserve(el);
            }
          });
        }, { rootMargin: "200px" });
        pages.forEach(p => io.observe(p));
      } else {
        // fallback لو المتصفح قديم
        pages.forEach(p => {
          const src = p.getAttribute("data-src");
          if (src) {
            p.style.backgroundImage = `url("${src}")`;
            p.removeAttribute("data-src");
          }
        });
      }
    }

    // تهيئة flipbook
    function initFlipbook() {
      const isMobile = window.innerWidth <= 768;
      $flipbook.turn({
        width: isMobile ? window.innerWidth * 0.95 : window.innerWidth * 0.406,
        height: isMobile ? window.innerHeight * 0.7 : window.innerHeight * 0.5,
        display: isMobile ? "single" : "double",
        autoCenter: true,
        elevation: 50,
        gradients: true,
      });
      lazyLoad();
    }

    $(document).ready(() => {
      initFlipbook();

      $(window).resize(() => {
        const isMobile = window.innerWidth <= 768;
        try {
          $flipbook.turn(
            "size",
            isMobile ? window.innerWidth * 0.95 : window.innerWidth * 0.406,
            isMobile ? window.innerHeight * 0.7 : window.innerHeight * 0.5
          );
          $flipbook.turn("display", isMobile ? "single" : "double");
        } catch (e) {}
      });
    });
  </script>
</body>
</html>
